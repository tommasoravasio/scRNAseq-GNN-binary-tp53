# Predicting TP53 Mutation Status from Single-Cell RNA-seq with Graph Neural Networks

## Overview
This project explores the application of **graph neural networks (GNNs)** to predict the mutational status of the TP53 gene from **single-cell RNA sequencing (scRNA-seq)** data. The pipeline leverages advanced machine learning and network analysis techniques to address a key problem in cancer genomics: identifying TP53 mutations, which are highly relevant for cancer diagnostics and research. This project was designed and implemented as my bachelor's thesis.

## Motivation
TP53, known as the "guardian of the genome," is one of the most frequently mutated genes in human cancers. Accurate detection of its mutation status is crucial for understanding tumor biology and guiding therapeutic decisions. This project demonstrates how modern deep learning, more specifically GNNs, can be used to extract biologically meaningful patterns from high-dimensional, noisy and sparse single-cell data.

## Key Features & Technologies
- **Graph Neural Networks:** Implementation of Graph Convolutional Networks (GCN) and Graph Attention Networks (GAT) for graph classification tasks.
- **Gene Co-expression Networks:** Construction of gene-gene graphs from scRNA-seq data using Spearman correlation.
- **Feature Selection:** Comparison of statistically driven (Highly Variable Genes, HVG) and biologically driven (TP53 target genes) feature selection strategies.
- **Batch Correction & Regularization:** Integration of ComBat and Harmony for batch effect correction; use of GraphNorm and L2 regularization.
- **Hyperparameter Optimization:** Automated tuning with Optuna.
- **Baseline Models:** XGBoost classifiers for benchmarking.
- **Core Libraries:** PyTorch, PyTorch Geometric, Scanpy, scikit-learn, XGBoost, Optuna, pandas, numpy, matplotlib, seaborn.

## Data Sources
- **Single-cell RNA-seq:** [Single Cell Breast Cancer Cell-line Atlas (Gambardella, 2022)](https://doi.org/10.6084/m9.figshare.15022698.v2)
- **TP53 Mutation Status:** [The TP53 Database](https://tp53.cancer.gov)
- **Bulk RNA-seq:** [Cancer Cell Line Encyclopedia (CCLE), DepMap 22q2](https://depmap.org/portal/download/)
- **TP53 Target Genes:** [Fischer’s curated list of p53 targets](https://tp53.cancer.gov/target_genes)

**Note:** Data is not included in this repository. Please download the datasets from the above sources and follow the instructions below for preprocessing.

## Getting Started
### 1. Clone the Repository
```bash
git clone https://github.com/tommasoravasio/scRNAseq-GNN-binary-tp53.git
cd scRNAseq-GNN-binary-tp53
```

### 2. Set Up the Environment
It is recommended to use a virtual environment. Install dependencies:
```bash
pip install -r requirements.txt
```

### 3. Download and Prepare Data
- Download the scRNA-seq, mutation, and bulk RNA-seq data from the sources above.
- Place the raw data in the `data/` directory, following the structure expected by the scripts (see comments in `src/load_data.py` and `src/preprocessing.py`).
- Update file paths in the notebook or scripts if needed.

### 4. Run the Pipeline

The workflow is **hybrid**:
- **Heavy computations** (e.g., graph construction, model training, hyperparameter optimization) are performed by running the shell scripts in the `jobs/` directory.  
  For example:
  ```bash
  bash jobs/preprocessing_run.sh
  bash jobs/network_contructor_run.sh
  bash jobs/model_run.sh
  ```
  *(Adjust the script and parameters as needed for your experiment.)*

- **Jupyter Notebook** (`notebooks/main_experiment.ipynb`) is used for:
  - Displaying results and visualizations
  - Interactive exploration and analysis
  - Loading and interpreting outputs generated by the scripts
  - **Performing lighter computations and preprocessing steps, such as data normalization**

**Typical workflow:**
1. Run the appropriate shell script(s) to generate data, graphs, or model results.
2. Use the notebook to preprocess data (e.g., normalization), visualize, and analyze the outputs.
3. Repeat as needed for different experiments or configurations.

## Results
- **XGBoost Baseline:** F1 score up to 0.995 (single-cell), 0.88 (bulk)
- **Best GNN Model:** GAT with ComBat batch correction on TP53 target genes, F1 score = 0.998
- **Interpretability:** Graph-based models capture gene–gene interactions, offering improved generalization and biological insight compared to classical ML approaches.

## Final report
The detailed report document describing this project can be found [here](Final_Report.pdf).



*For questions or collaboration opportunities, feel free to contact me.*
